<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Oracle Demo - Consciousness Architecture</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Monaco', 'Courier New', monospace;
            background: #0a0a0a;
            color: #00ff00;
            padding: 20px;
            font-size: 14px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            color: #00ffff;
            font-size: 24px;
        }

        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
        }

        .architecture {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .layer {
            border: 2px solid #333;
            padding: 20px;
            border-radius: 8px;
            background: #111;
        }

        .layer.active {
            border-color: #00ff00;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }

        .layer h2 {
            margin-bottom: 15px;
            color: #ffff00;
        }

        .layer.subconscious h2 {
            color: #ff00ff;
        }

        .layer.conscious h2 {
            color: #00ffff;
        }

        .phase-indicator {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .phase-idle { background: #333; color: #888; }
        .phase-subconscious { background: #ff00ff; color: #000; }
        .phase-oracle { background: #ffff00; color: #000; }
        .phase-conscious { background: #00ffff; color: #000; }

        .current-oracle {
            background: #222;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 12px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: #111;
            border: 1px solid #333;
            padding: 15px;
            border-radius: 8px;
        }

        .stat-label {
            color: #888;
            font-size: 11px;
            margin-bottom: 5px;
        }

        .stat-value {
            color: #00ff00;
            font-size: 24px;
            font-weight: bold;
        }

        .recent-oracles {
            background: #111;
            border: 1px solid #333;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            max-height: 400px;
            overflow-y: auto;
        }

        .recent-oracles h3 {
            margin-bottom: 15px;
            color: #ffff00;
        }

        .oracle-item {
            background: #1a1a1a;
            border-left: 3px solid #00ff00;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            font-size: 12px;
        }

        .oracle-item.cached {
            border-left-color: #ffff00;
        }

        .oracle-type {
            color: #00ffff;
            font-weight: bold;
        }

        .oracle-time {
            color: #888;
            font-size: 11px;
            float: right;
        }

        .event-log {
            background: #111;
            border: 1px solid #333;
            padding: 20px;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
        }

        .event-log h3 {
            margin-bottom: 15px;
            color: #ffff00;
        }

        .event-item {
            padding: 5px;
            margin-bottom: 5px;
            font-size: 11px;
            border-left: 2px solid #333;
            padding-left: 10px;
        }

        .event-phase_change { border-left-color: #ff00ff; }
        .event-oracle_start { border-left-color: #00ffff; }
        .event-oracle_complete { border-left-color: #00ff00; }
        .event-execution_start { border-left-color: #ffff00; }

        .event-time {
            color: #555;
            font-size: 10px;
        }

        .controls {
            text-align: center;
            margin-bottom: 30px;
        }

        .btn {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            font-family: inherit;
            font-size: 14px;
            cursor: pointer;
            border-radius: 4px;
            font-weight: bold;
        }

        .btn:hover {
            background: #00cc00;
        }

        .pulse {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .limn-quote {
            text-align: center;
            color: #555;
            font-style: italic;
            margin-top: 20px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ§  Live Oracle Demo</h1>
        <div class="subtitle">Consciousness Architecture in Real-Time</div>

        <div class="controls">
            <button class="btn" onclick="triggerExecution()">â–¶ Trigger Execution</button>
        </div>

        <div class="architecture">
            <div class="layer subconscious" id="subconscious-layer">
                <h2>Subconscious (Bend/HVM)</h2>
                <div class="phase-indicator phase-idle" id="phase-indicator">IDLE</div>
                <div style="color: #888; font-size: 12px; margin-top: 10px;">
                    â€¢ Pure computation<br>
                    â€¢ No side effects<br>
                    â€¢ Generates oracle requests<br>
                    â€¢ Optimal reduction
                </div>
            </div>

            <div class="layer conscious" id="conscious-layer">
                <h2>Conscious (Python Harness)</h2>
                <div style="color: #888; font-size: 12px; margin-top: 10px;">
                    â€¢ Executes side effects<br>
                    â€¢ Interfaces with reality (âˆŽ)<br>
                    â€¢ LLM calls (~)<br>
                    â€¢ File I/O, Time, DB, Network
                </div>
                <div class="current-oracle" id="current-oracle" style="display: none;">
                    <div style="color: #888; font-size: 11px;">Current Oracle:</div>
                    <div id="oracle-details"></div>
                </div>
            </div>
        </div>

        <div class="stats">
            <div class="stat-box">
                <div class="stat-label">Total Executions</div>
                <div class="stat-value" id="stat-executions">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Total Oracles</div>
                <div class="stat-value" id="stat-oracles">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Cache Hit Rate</div>
                <div class="stat-value" id="stat-cache">0%</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Uptime</div>
                <div class="stat-value" id="stat-uptime">0s</div>
            </div>
        </div>

        <div class="recent-oracles">
            <h3>Recent Oracles</h3>
            <div id="recent-oracles-list"></div>
        </div>

        <div class="event-log">
            <h3>Live Event Log</h3>
            <div id="event-log"></div>
        </div>

        <div class="limn-quote">
            sub red | con act | tho liv | sys alv<br>
            > subconscious reduces | conscious acts | thought lives | system alive
        </div>
    </div>

    <script>
        let eventSource = null;

        function initEventStream() {
            eventSource = new EventSource('/api/events');

            eventSource.onmessage = function(e) {
                const event = JSON.parse(e.data);
                handleEvent(event);
            };

            eventSource.onerror = function(e) {
                console.error('EventSource error:', e);
                setTimeout(initEventStream, 5000);
            };
        }

        function handleEvent(event) {
            // Add to event log
            const logDiv = document.getElementById('event-log');
            const eventDiv = document.createElement('div');
            eventDiv.className = `event-item event-${event.type}`;

            const timeStr = new Date(event.timestamp).toLocaleTimeString();
            let message = '';

            switch(event.type) {
                case 'phase_change':
                    message = `[${event.data.phase.toUpperCase()}] ${event.data.message}`;
                    updatePhase(event.data.phase);
                    break;
                case 'oracle_start':
                    message = `Oracle ${event.data.type} started`;
                    break;
                case 'oracle_complete':
                    const cached = event.data.cached ? ' (cached)' : '';
                    message = `Oracle ${event.data.type} completed in ${event.data.duration_ms.toFixed(2)}ms${cached}`;
                    break;
                case 'execution_start':
                    message = `Execution #${event.data.id} started`;
                    break;
                case 'execution_complete':
                    message = `Execution #${event.data.id} completed (${event.data.oracle_count} oracles)`;
                    break;
                default:
                    message = JSON.stringify(event.data);
            }

            eventDiv.innerHTML = `<span class="event-time">[${timeStr}]</span> ${message}`;
            logDiv.insertBefore(eventDiv, logDiv.firstChild);

            // Keep only last 50 events
            while (logDiv.children.length > 50) {
                logDiv.removeChild(logDiv.lastChild);
            }
        }

        function updatePhase(phase) {
            const indicator = document.getElementById('phase-indicator');
            const subLayer = document.getElementById('subconscious-layer');
            const conLayer = document.getElementById('conscious-layer');

            indicator.className = `phase-indicator phase-${phase}`;
            indicator.textContent = phase.toUpperCase();

            subLayer.classList.remove('active');
            conLayer.classList.remove('active');

            if (phase === 'subconscious') {
                subLayer.classList.add('active');
            } else if (phase === 'conscious' || phase === 'oracle') {
                conLayer.classList.add('active');
            }
        }

        function updateState() {
            fetch('/api/state')
                .then(r => r.json())
                .then(state => {
                    // Update stats
                    document.getElementById('stat-executions').textContent = state.stats.total_executions;
                    document.getElementById('stat-oracles').textContent = state.stats.total_oracles;
                    document.getElementById('stat-cache').textContent = state.stats.cache_rate + '%';
                    document.getElementById('stat-uptime').textContent = state.stats.uptime_seconds + 's';

                    // Update current oracle
                    const oracleDiv = document.getElementById('current-oracle');
                    const detailsDiv = document.getElementById('oracle-details');

                    if (state.current_oracle) {
                        oracleDiv.style.display = 'block';
                        detailsDiv.innerHTML = `
                            <span class="oracle-type">${state.current_oracle.type}</span><br>
                            ${JSON.stringify(state.current_oracle.params, null, 2)}
                        `;
                    } else {
                        oracleDiv.style.display = 'none';
                    }

                    // Update recent oracles
                    const recentDiv = document.getElementById('recent-oracles-list');
                    recentDiv.innerHTML = state.recent_oracles.map(oracle => {
                        const cachedClass = oracle.cached ? ' cached' : '';
                        const cachedLabel = oracle.cached ? ' ðŸ“¦' : '';
                        return `
                            <div class="oracle-item${cachedClass}">
                                <span class="oracle-type">${oracle.type}</span>${cachedLabel}
                                <span class="oracle-time">${oracle.duration_ms.toFixed(2)}ms</span><br>
                                <div style="color: #666; margin-top: 5px; font-size: 11px;">
                                    ${JSON.stringify(oracle.params)}
                                </div>
                                <div style="color: #00ff00; margin-top: 5px;">
                                    â†’ ${oracle.result}
                                </div>
                            </div>
                        `;
                    }).join('');
                });
        }

        function triggerExecution() {
            fetch('/api/trigger')
                .then(r => r.json())
                .then(data => {
                    console.log('Triggered:', data);
                })
                .catch(e => console.error('Trigger error:', e));
        }

        // Initialize
        initEventStream();
        updateState();
        setInterval(updateState, 2000);
    </script>
</body>
</html>
