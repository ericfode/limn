#!/bin/bash
#
# mock-llm - Simulated LLM CLI for testing
#
# This script simulates an LLM API call with realistic behavior:
# - Takes query as argument
# - Simulates processing delay
# - Returns mock response
# - Tracks timing information
#
# Usage: ./mock-llm "your query here"

QUERY="$1"
START_TIME=$(date +%s%N)

# Simulate LLM processing delay (configurable via env var)
DELAY_MS=${LLM_DELAY_MS:-100}
sleep $(echo "scale=3; $DELAY_MS / 1000" | bc) 2>/dev/null || sleep 0.1

# Generate mock response based on query
if [[ -z "$QUERY" ]]; then
    echo "Error: No query provided" >&2
    exit 1
fi

# Mock response generation
RESPONSE="Mock LLM Response: You asked about '$QUERY'. Here is a simulated answer with some details. This response is generated by a mock LLM for testing purposes."

# Add some variation based on query length
QUERY_LEN=${#QUERY}
if [ $QUERY_LEN -gt 50 ]; then
    RESPONSE="$RESPONSE This was a long query, so here's an extended response with additional context and information."
fi

# Output response
echo "$RESPONSE"

# Log timing to stderr
END_TIME=$(date +%s%N)
ELAPSED_MS=$(( (END_TIME - START_TIME) / 1000000 ))
echo "[mock-llm] Processed in ${ELAPSED_MS}ms" >&2

exit 0
